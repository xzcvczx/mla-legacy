<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:x="urn:schemas-microsoft-com:office:excel"
xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List
href="Migration%20Notes%20v2.3%20to%20v2.4_files/filelist.xml">
<title>Migration from Microchip USB firmware framework v1</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="country-region"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>C12109</o:Author>
  <o:LastAuthor>C12109</o:LastAuthor>
  <o:Revision>69</o:Revision>
  <o:TotalTime>1200</o:TotalTime>
  <o:Created>2008-03-30T19:43:00Z</o:Created>
  <o:LastSaved>2009-02-25T00:02:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>404</o:Words>
  <o:Characters>2304</o:Characters>
  <o:Company>Microchip Technology Inc</o:Company>
  <o:Lines>19</o:Lines>
  <o:Paragraphs>5</o:Paragraphs>
  <o:CharactersWithSpaces>2703</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>90</w:Zoom>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:16.0pt;
	font-family:Arial;
	mso-font-kerning:16.0pt;}
h2
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:14.0pt;
	font-family:Arial;
	font-style:italic;}
h3
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:13.0pt;
	font-family:Arial;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{mso-style-update:auto;
	mso-style-noshow:yes;
	mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:12.0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{mso-style-update:auto;
	mso-style-noshow:yes;
	mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:24.0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
p.MsoPlainText, li.MsoPlainText, div.MsoPlainText
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 65.95pt 1.0in 65.95pt;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:.5in'>

<div class=Section1>

<p class=MsoNormal align=center style='text-align:center'><b style='mso-bidi-font-weight:
normal'><u><span style='font-size:16.0pt;font-family:Arial'>Migration notes -
Microchip USB firmware framework v2.3 to v2.4<o:p></o:p></span></u></b></p>

<p class=MsoNormal align=center style='text-align:center'><b style='mso-bidi-font-weight:
normal'><u><span style='font-size:16.0pt;font-family:Arial'><o:p><span
 style='text-decoration:none'>&nbsp;</span></o:p></span></u></b></p>

<p class=MsoToc2 style='tab-stops:right dotted 479.6pt'><!--[if supportFields]><span
style='font-family:Arial'><span style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>TOC \o &quot;1-3&quot; \n \h \z \u <span
style='mso-element:field-separator'></span></span><![endif]--><span
class=MsoHyperlink><span style='mso-no-proof:yes'><a href="#_Toc223258254">Callback
Mechanism</a></span></span><span style='mso-no-proof:yes'><o:p></o:p></span></p>

<p class=MsoToc2 style='tab-stops:right dotted 479.6pt'><span
class=MsoHyperlink><span style='mso-no-proof:yes'><a href="#_Toc223258255">USB_NUM_STRING_DESCRIPTORS</a></span></span><span
style='mso-no-proof:yes'><o:p></o:p></span></p>

<p class=MsoPlainText><!--[if supportFields]><span style='font-family:Arial'><span
style='mso-element:field-end'></span></span><![endif]--><span style='font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<h2><a name="_Toc223258254">Callback Mechanism</a></h2>

<p class=MsoPlainText style='margin-left:.5in'><span style='font-family:Arial'>With
the introduction of the interrupt driven option of the stack there are some
compile time options available to select the functionality in regards to how
the stack notifies users of events in the stack.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='text-indent:.5in'><span style='font-family:Arial'>To
support interrupts using the legacy callback functions in v2.3 define the
following definition in <span class=SpellE>usb_config.h</span>:<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:.5in'><span
style='font-family:Arial'>#define USB_INTERRUPT_LEGACY_CALLBACKS<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:Arial'><span style='mso-tab-count:
1'>            </span>This will cause the stack to call the callback functions
directly when the event occurs.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:.5in'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-left:.5in'><span style='font-family:Arial'>Because
it is not always desirable to get every single event for CPU usage reasons,
definitions have been created in order to enable the desired events.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:.5in'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-left:.5in'><span style='font-family:Arial'>The
USB_ENABLE_ALL_HANDLERS can be defined in <span class=SpellE>usb_config.h</span>
to enable all of the events.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:.5in'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-left:.5in'><span style='font-family:Arial'>If
only certain events are desired then the following definitions can be made in
the <span class=SpellE>usb_config.h</span> file to enable those features.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>#define
USB_ENABLE_SUSPEND_HANDLER<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>#define
USB_ENABLE_WAKEUP_FROM_SUSPEND_HANDLER<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>#define
USB_ENABLE_SOF_HANDLER<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>#define
USB_ENABLE_ERROR_HANDLER<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>#define
USB_ENABLE_OTHER_REQUEST_HANDLER<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>#define
USB_ENABLE_SET_DESCRIPTOR_HANDLER<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>#define
USB_ENABLE_INIT_EP_HANDLER<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>#define
USB_ENABLE_EP0_DATA_HANDLER<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>#define
USB_ENABLE_TRANSFER_COMPLETE_HANDLER<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<h2><a name="_Toc223258255">USB_NUM_STRING_DESCRIPTORS</a></h2>

<p class=MsoPlainText style='margin-left:.5in'><span style='font-family:Arial'>The
USB_NUM_STRING_DESCRIPTORS has been added as a required definition to the <span
class=SpellE>usb_config.h</span> file. <span style='mso-spacerun:yes'> </span>This
number should indicate the total number of USB strings that are in the string
descriptors array, including the language string descriptors.<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:.5in'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-left:.5in'><span style='font-family:Arial'>Take
the following example:<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:.5in'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>//Language
code string descriptor<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>ROM
<span class=SpellE><span class=GramE>struct</span></span><span class=GramE>{</span>BYTE
<span class=SpellE>bLength;BYTE</span> <span class=SpellE>bDscType;WORD</span>
string[1];}sd000={<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span class=SpellE><span
class=GramE><span style='font-family:Arial'>sizeof</span></span></span><span
class=GramE><span style='font-family:Arial'>(</span></span><span
style='font-family:Arial'>sd000),USB_DESCRIPTOR_STRING,{0x0409<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>}};<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>//Manufacturer
string descriptor<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>ROM
<span class=SpellE><span class=GramE>struct</span></span><span class=GramE>{</span>BYTE
<span class=SpellE>bLength;BYTE</span> <span class=SpellE>bDscType;WORD</span>
string[25];}sd001={<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span class=SpellE><span
class=GramE><span style='font-family:Arial'>sizeof</span></span></span><span
class=GramE><span style='font-family:Arial'>(</span></span><span
style='font-family:Arial'>sd001),USB_DESCRIPTOR_STRING,<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>{'<span
class=SpellE>M','i','c','r','o','c','h','i','p</span>',' ',<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>'<span
class=SpellE>T','e','c','h','n','o','l','o','g','y</span>',' ','<span
class=SpellE>I','n','c</span>','.'<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>}};<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>//Product
string descriptor<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>ROM
<span class=SpellE><span class=GramE>struct</span></span><span class=GramE>{</span>BYTE
<span class=SpellE>bLength;BYTE</span> <span class=SpellE>bDscType;WORD</span>
string[22];}sd002={<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span class=SpellE><span
class=GramE><span style='font-family:Arial'>sizeof</span></span></span><span
class=GramE><span style='font-family:Arial'>(</span></span><span
style='font-family:Arial'>sd002),USB_DESCRIPTOR_STRING,<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>{'<span
class=SpellE>K','e','y','b','o','a','r','d</span>',' ','<span class=SpellE>D','e','m','o</span>'<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>}};<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>//Array
of string descriptors<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>ROM
BYTE *ROM <span class=SpellE>USB_SD_<span class=GramE>Ptr</span></span><span
class=GramE>[</span>]=<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>{<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'><span
style='mso-spacerun:yes'>    </span>(ROM BYTE *ROM)&amp;sd000,<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'><span
style='mso-spacerun:yes'>    </span>(ROM BYTE *ROM)&amp;sd001,<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'><span
style='mso-spacerun:yes'>    </span>(ROM BYTE *ROM)&amp;sd002<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'>};<o:p></o:p></span></p>

<p class=MsoPlainText style='margin-left:1.0in'><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:Arial'><span style='mso-tab-count:
1'>            </span>In this example the USB_NUM_STRING_DESCRIPTORS should be
defined as 3, matching the size of the <span class=SpellE>USB_SD_Ptr</span>
array.<o:p></o:p></span></p>

<p class=MsoPlainText><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><a name="_Toc223256482"><b style='mso-bidi-font-weight:normal'><span
style='font-size:16.0pt'>Trademarks:</span></b></a><b style='mso-bidi-font-weight:
normal'><span style='font-size:16.0pt'><o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><i><span style='font-size:10.0pt;
font-family:Arial;color:black'>The Microchip name and logo, the Microchip logo,
MPLAB, and PIC are registered trademarks of Microchip Technology Incorporated
in the <st1:place w:st="on"><st1:country-region w:st="on">U.S.A.</st1:country-region></st1:place>
and other countries.<o:p></o:p></span></i></p>

<p class=MsoPlainText><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>

</div>

</body>

</html>
